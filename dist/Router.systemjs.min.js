System.register(["jb-modules/ExceptionHandler/ExceptionHandler","react","react-dom"],function(a,b){"use strict";var c,d,e;return{setters:[function(a){c=a.default},function(a){d=a.default},function(a){e=a.default}],execute:function(){function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function h(a,b,c){return b&&g(a.prototype,b),c&&g(a,c),a}function i(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function j(a){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},j(a)}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function l(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function m(a,b,c){return b&&l(a.prototype,b),c&&l(a,c),a}function n(a,b){return b&&("object"===j(b)||"function"==typeof b)?b:s(a)}function p(a){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},p(a)}function q(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&r(a,b)}function r(a,b){return r=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},r(a,b)}function s(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function t(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function u(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function v(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){A(a,b,c[b])})}return a}function w(a){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},w(a)}function x(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function y(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function z(a,b,c){return b&&y(a.prototype,b),c&&y(a,c),a}function A(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var B=function(){function a(b){f(this,a),i(this,"url",null),i(this,"name",null),i(this,"settings",{}),i(this,"title",""),i(this,"isRoot",void 0),i(this,"params",void 0),i(this,"regex",void 0),this.url=b.url,this.name=b.name,this.title=b.title,this.settings=b.settings,this.isRoot="/"==this.url,this.params={},this.regex=new RegExp(this.url.concat("$").toLowerCase().replace(/\{\w+\}/g,"([\\w-]+)")),this._extractUrlParamsKey()}return h(a,[{key:"_extractUrlParamsKey",value:function(){for(var a,b=new RegExp(/\{(\w+)\}/g);a=b.exec(this.url);)this.params[a[1]]=null}},{key:"load",value:function(){alert("not implemented")}},{key:"_loadResource",value:function(a){return new Promise(function(c,d){b.import(a).then(function(a){c(a)}).catch(function(a){d(a)})})}}]),a}(),C=function(a){function b(a){var c;return k(this,b),c=n(this,p(b).call(this,a)),t(s(s(c)),"componentPath",null),c.componentPath=a.reactComponentPath,c}return q(b,a),m(b,[{key:"load",value:function(){var a=this;return new Promise(function(b,c){a._loadResource(a.componentPath).then(function(a){a.default?b(a.default):c({message:"the react component you want to load and initiate does not export defualt class to initiate. please add <export defualt ClassName> in your js file"})}).catch(function(a){c(a)})})}},{key:"loadge",value:function(a,b){return new Promise(function(c){e.unmountComponentAtNode(b),e.render(d.createElement(a,null),b,function(){c(a)})})}}]),b}(B),D=function a(b){switch(u(this,a),b.type){case"REACT":return new C(b);break;case void 0:return new B(b);}},E=[],F=Symbol(),G=function(){function a(b){var c=this;if(x(this,a),A(this,"treeBaseRoutes",[]),A(this,"routes",[]),A(this,"errorRoutes",{}),A(this,"routeGroupsName",[]),A(this,"basePath",void 0),A(this,"matchedRoute",{}),A(this,"componentsPathPrefix","/"),A(this,"pageContainerTagId",void 0),A(this,"isPageContainerMounted",!1),A(this,"params",{}),A(this,"currentPage",{routeDataObject:{},params:{},jsClass:null}),A(this,"pagesTitlePrefix",""),A(this,"loadState",void 0),A(this,"config",{instanceName:"defualt",events:{onLoadStateChange:null}}),"object"==w(b)&&Object.assign(this.config,b),!E[this.config.instanceName])E[this.config.instanceName]=this;else return E[this.config.instanceName];return this.treeBaseRoutes=this.config.routes,this.basePath=this.config.basePath,this.pageContainerTagId=this.config.pageContainerTagId,this.componentsPathPrefix=this.config.componentsPathPrefix,this.pagesTitlePrefix=this.config.pagesTitlePrefix,this._initLoadState(),this._normalizeAndOptimazeRoutes(),window.addEventListener("popstate",function(a){return c._onBrowserPopState(a)}),E[this.config.instanceName]}return z(a,[{key:"pageContainerDidMount",value:function(){return this.containerDom=document.getElementById(this.pageContainerTagId),this.containerDom?void(this.isPageContainerMounted=!0):(c.newException("router can't find dom with "+this.pageContainerTagId+" ID maybe your html page is not ready yet"),!1)}},{key:"_initLoadState",value:function(){this[F]=null}},{key:"_callLoadStateChange",value:function(a,b){this.config.events.onLoadStateChange&&this.config.events.onLoadStateChange(a,b)}},{key:"_onBrowserPopState",value:function(a){var b=a.state;return b&&b.pushedByJBRouter&&this.loadPage(b.absolutePath,!1),!0}},{key:"_normalizeAndOptimazeRoutes",value:function(){var a=this;(function b(c,d,e){var f=!0,g=!1,h=void 0;try{for(var i,j,k=c[Symbol.iterator]();!(f=(i=k.next()).done);f=!0){j=i.value,j.settings=Object.assign(j.settings||{},e),j.url=d+j.url,j.reactComponentPath&&(j.reactComponentPath=a.componentsPathPrefix+j.reactComponentPath);var l=new D(j);a.routes.push(l),j.childRoutes&&b(j.childRoutes,l.url,l.settings)}}catch(a){g=!0,h=a}finally{try{f||null==k.return||k.return()}finally{if(g)throw h}}})(this.treeBaseRoutes,"",{}),this.config.standardPageRoutes[404]&&(this.errorRoutes[404]=new D(this.config.standardPageRoutes[404])),this.config.standardPageRoutes[424]&&(this.errorRoutes[424]=new D(this.config.standardPageRoutes[424]))}},{key:"_matchPathToOneRoute",value:function(a){var b,c=!0,d=!1,e=void 0;try{for(var f,g,h=this.routes[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)if(g=f.value,"/"==a&&g.isRoot){b=g;break}else if("/"!=a&&!g.isRoot&&(b=a.match(g.regex),b)){var j=1;for(var k in g.params)g.params[k]=b[j++];b=g,this.params=g.params;break}}catch(a){d=!0,e=a}finally{try{c||null==h.return||h.return()}finally{if(d)throw e}}return this.matchedRoute=b?b:this.errorRoutes[404],this.matchedRoute}},{key:"loadPage",value:function(a,b){if(!this.isPageContainerMounted)return c.newException("router can`t load route and render it before 'pageContainerDidMount' function called"),!1;var d=this._normalizePath(a);if(-1!=d){var e=this._matchPathToOneRoute(d);if(e){var f=!0;if(null!=e.componentPath&&null!=e.componentPath||(f=!1,c.newException(new Error(e),"the matched Route we find dosent have any component path to load. /n please define component path so we can load and place it")),f)return this._callLoadStateChange(this[F],0),this[F]=0,this._loadComponent(e),this._setPageAttributes(e.title,a,b),e}else return c.newException(new Error(a),"\u0622\u062F\u0631\u0633 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F"),-1}else return c.newException(new Error(a,"\u0622\u062F\u0631\u0633 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F")),-1}},{key:"_loadComponent",value:function(a){var b=this;a.load().then(function(c){b._onRouteLoadComplete(a,c)}).catch(function(c){b._onRouteLoadError(c,a)})}},{key:"_setPageAttributes",value:function(a,b){var c=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];if(document.title=a+" | "+this.pagesTitlePrefix,c){var d={pushedByJBRouter:!0,routeObject:this.matchedRoute,absolutePath:b};window.history.pushState(d,this.pagesTitlePrefix+a,b)}}},{key:"_onRouteLoadComplete",value:function(a,b){var d=this;this._callLoadStateChange(this[F],1),this[F]=1,a.loadge(b,this.containerDom).then(function(a){d._onRouteLoadgeComplete(a)}).catch(function(a){c.newException(a,"we have exception in loadge the page. \n"),d._onRouteLoadError(a,reactRoute)})}},{key:"_onRouteLoadError",value:function(a,b){var d=this;c.newException(a,"\u062F\u0631 \u0647\u0646\u06AF\u0627\u0645 \u0644\u0648\u062F \u06A9\u0627\u0645\u067E\u0648\u0646\u0646\u062A \u0645\u0634\u06A9\u0644\u06CC \u067E\u06CC\u0634 \u0622\u0645\u062F\u0647 \u0627\u0633\u062A"),this.loadComponentTryCount?this.loadComponentTryCount++:this.loadComponentTryCount=1,6>this.loadComponentTryCount?setTimeout(function(){d._loadComponent(b)},2e3*this.loadComponentTryCount):this._loadComponent(this.errorRoutes[424])}},{key:"_onRouteLoadgeComplete",value:function(a){this.currentPage.routeDataObject=v({},this.matchedRoute),this.currentPage.jsClass=v({},a),this.currentPage.params=v({},this.params),this._callLoadStateChange(this[F],5),this[F]=5}},{key:"_normalizePath",value:function(a){var b=a.toLowerCase(),c=b.indexOf(this.basePath.toLowerCase());if(-1==c)return-1;var d=b.substring(this.basePath.length,b.length);return"/"==d[d.length-1]&&"/"!=d?d=d.substring(0,d.length-1):""==d&&(d="/"),-1!=d.lastIndexOf("?")&&(d=d.slice(0,d.lastIndexOf("?"))),d}},{key:"loadState",get:function(){return this[F]},set:function(a){4<a&&10>a?(this._callLoadStateChange(this[F],a),this[F]=a):c.newException({invalidValue:a},"\u0645\u0642\u062F\u0627\u0631 \u0633\u062A \u0634\u062F\u0647 \u0628\u0631\u0627\u06CC \u0648\u0636\u0639\u06CC\u062A \u0644\u0648\u062F\u06CC\u0646\u06AF \u0646\u0645\u06CC\u062A\u0648\u0627\u0646\u062F \u06A9\u0645\u062A\u0631 \u067E\u0646\u062C \u0648 \u0628\u06CC\u0634\u062A\u0631 \u0627\u0632 \u062F\u0647 \u0628\u0627\u0634\u062F \n")}}]),a}();a("default",G)}}});
