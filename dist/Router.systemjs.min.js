System.register(["jb-modules/ExceptionHandler/ExceptionHandler","react","react-dom"],function(a){"use strict";var b,c,d;return{setters:[function(a){b=a.default},function(a){c=a.default},function(a){d=a.default}],execute:function(){function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}function h(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function i(a){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},i(a)}function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function l(a,b,c){return b&&k(a.prototype,b),c&&k(a,c),a}function m(a,b){return b&&("object"===i(b)||"function"==typeof b)?b:r(a)}function n(a){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},n(a)}function o(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&q(a,b)}function q(a,b){return q=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},q(a,b)}function r(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function s(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function u(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){z(a,b,c[b])})}return a}function v(a){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},v(a)}function w(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function x(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function y(a,b,c){return b&&x(a.prototype,b),c&&x(a,c),a}function z(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var A=function(){function a(b){e(this,a),h(this,"url",null),h(this,"name",null),h(this,"settings",{}),h(this,"title",""),h(this,"isRoot",void 0),h(this,"params",void 0),h(this,"regex",void 0),this.url=b.url,this.name=b.name,this.title=b.title,this.settings=b.settings,this.isRoot="/"==this.url,this.params={},this.regex=new RegExp(this.url.concat("$").toLowerCase().replace(/\{\w+\}/g,"([\\w-]+)")),this._extractUrlParamsKey()}return g(a,[{key:"_extractUrlParamsKey",value:function(){for(var a,b=new RegExp(/\{(\w+)\}/g);a=b.exec(this.url);)this.params[a[1]]=null}},{key:"load",value:function(){alert("not implemented")}},{key:"_loadResource",value:function(a){return new Promise(function(b,c){SystemJS||(console.error("we need systemjs  as a dependency to load modules pls setup systemjs for that"),c("systemjs is not defined")),SystemJS.import(a).then(function(a){b(a)}).catch(function(a){c(a)})})}}]),a}(),B=function(a){function b(a){var c;return j(this,b),c=m(this,n(b).call(this,a)),s(r(r(c)),"componentPath",null),c.componentPath=a.reactComponentPath,c}return o(b,a),l(b,[{key:"load",value:function(){var a=this;return new Promise(function(b,c){a._loadResource(a.componentPath).then(function(a){a.default?b(a.default):c({message:"the react component you want to load and initiate does not export defualt class to initiate. please add <export defualt ClassName> in your js file"})}).catch(function(a){c(a)})})}},{key:"loadge",value:function(a,b){return new Promise(function(e){d.unmountComponentAtNode(b),d.render(c.createElement(a,null),b,function(){e(a)})})}}]),b}(A),C=function a(b){switch(t(this,a),b.type){case"REACT":return new B(b);break;case void 0:return new A(b);}},D=[],E=Symbol(),F=function(){function a(b){var c=this;if(w(this,a),z(this,"treeBaseRoutes",[]),z(this,"routes",[]),z(this,"errorRoutes",{}),z(this,"routeGroupsName",[]),z(this,"basePath",void 0),z(this,"matchedRoute",{}),z(this,"componentsPathPrefix","/"),z(this,"pageContainerTagId",void 0),z(this,"isPageContainerMounted",!1),z(this,"params",{}),z(this,"currentPage",{routeDataObject:{},params:{},jsClass:null}),z(this,"pagesTitlePrefix",""),z(this,"loadState",void 0),z(this,"config",{instanceName:"defualt",events:{onLoadStateChange:null}}),"object"==v(b)&&Object.assign(this.config,b),!D[this.config.instanceName])D[this.config.instanceName]=this;else return D[this.config.instanceName];return this.treeBaseRoutes=this.config.routes,this.basePath=this.config.basePath,this.pageContainerTagId=this.config.pageContainerTagId,this.componentsPathPrefix=this.config.componentsPathPrefix,this.pagesTitlePrefix=this.config.pagesTitlePrefix,this._initLoadState(),this._normalizeAndOptimazeRoutes(),window.addEventListener("popstate",function(a){return c._onBrowserPopState(a)}),D[this.config.instanceName]}return y(a,[{key:"pageContainerDidMount",value:function(){return this.containerDom=document.getElementById(this.pageContainerTagId),this.containerDom?void(this.isPageContainerMounted=!0):(b.newException("router can't find dom with "+this.pageContainerTagId+" ID maybe your html page is not ready yet"),!1)}},{key:"_initLoadState",value:function(){this[E]=null}},{key:"_callLoadStateChange",value:function(a,b){this.config.events.onLoadStateChange&&this.config.events.onLoadStateChange(a,b)}},{key:"_onBrowserPopState",value:function(a){var b=a.state;return b&&b.pushedByJBRouter&&this.loadPage(b.absolutePath,!1),!0}},{key:"_normalizeAndOptimazeRoutes",value:function(){var a=this;(function b(c,d,e){var f=!0,g=!1,h=void 0;try{for(var i,j,k=c[Symbol.iterator]();!(f=(i=k.next()).done);f=!0){j=i.value,j.settings=Object.assign(j.settings||{},e),j.url=d+j.url,j.reactComponentPath&&(j.reactComponentPath=a.componentsPathPrefix+j.reactComponentPath);var l=new C(j);a.routes.push(l),j.childRoutes&&b(j.childRoutes,l.url,l.settings)}}catch(a){g=!0,h=a}finally{try{f||null==k.return||k.return()}finally{if(g)throw h}}})(this.treeBaseRoutes,"",{}),this.config.standardPageRoutes[404]&&(this.errorRoutes[404]=new C(this.config.standardPageRoutes[404])),this.config.standardPageRoutes[424]&&(this.errorRoutes[424]=new C(this.config.standardPageRoutes[424]))}},{key:"_matchPathToOneRoute",value:function(a){var b,c=!0,d=!1,e=void 0;try{for(var f,g,h=this.routes[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)if(g=f.value,"/"==a&&g.isRoot){b=g;break}else if("/"!=a&&!g.isRoot&&(b=a.match(g.regex),b)){var j=1;for(var k in g.params)g.params[k]=b[j++];b=g,this.params=g.params;break}}catch(a){d=!0,e=a}finally{try{c||null==h.return||h.return()}finally{if(d)throw e}}return this.matchedRoute=b?b:this.errorRoutes[404],this.matchedRoute}},{key:"loadPage",value:function(a,c){if(!this.isPageContainerMounted)return b.newException("router can`t load route and render it before 'pageContainerDidMount' function called"),!1;var d=this._normalizePath(a);if(-1!=d){var e=this._matchPathToOneRoute(d);if(e){var f=!0;if(null!=e.componentPath&&null!=e.componentPath||(f=!1,b.newException(new Error(e),"the matched Route we find dosent have any component path to load. /n please define component path so we can load and place it")),f)return this._callLoadStateChange(this[E],0),this[E]=0,this._loadComponent(e),this._setPageAttributes(e.title,a,c),e}else return b.newException(new Error(a),"\u0622\u062F\u0631\u0633 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F"),-1}else return b.newException(new Error(a,"\u0622\u062F\u0631\u0633 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F")),-1}},{key:"_loadComponent",value:function(a){var b=this;a.load().then(function(c){b._onRouteLoadComplete(a,c)}).catch(function(c){b._onRouteLoadError(c,a)})}},{key:"_setPageAttributes",value:function(a,b){var c=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];if(document.title=a+" | "+this.pagesTitlePrefix,c){var d={pushedByJBRouter:!0,routeObject:this.matchedRoute,absolutePath:b};window.history.pushState(d,this.pagesTitlePrefix+a,b)}}},{key:"_onRouteLoadComplete",value:function(a,c){var d=this;this._callLoadStateChange(this[E],1),this[E]=1,a.loadge(c,this.containerDom).then(function(a){d._onRouteLoadgeComplete(a)}).catch(function(a){b.newException(a,"we have exception in loadge the page. \n"),d._onRouteLoadError(a,reactRoute)})}},{key:"_onRouteLoadError",value:function(a,c){var d=this;b.newException(a,"\u062F\u0631 \u0647\u0646\u06AF\u0627\u0645 \u0644\u0648\u062F \u06A9\u0627\u0645\u067E\u0648\u0646\u0646\u062A \u0645\u0634\u06A9\u0644\u06CC \u067E\u06CC\u0634 \u0622\u0645\u062F\u0647 \u0627\u0633\u062A"),this.loadComponentTryCount?this.loadComponentTryCount++:this.loadComponentTryCount=1,6>this.loadComponentTryCount?setTimeout(function(){d._loadComponent(c)},2e3*this.loadComponentTryCount):this._loadComponent(this.errorRoutes[424])}},{key:"_onRouteLoadgeComplete",value:function(a){this.currentPage.routeDataObject=u({},this.matchedRoute),this.currentPage.jsClass=u({},a),this.currentPage.params=u({},this.params),this._callLoadStateChange(this[E],5),this[E]=5}},{key:"_normalizePath",value:function(a){var b=a.toLowerCase(),c=b.indexOf(this.basePath.toLowerCase());if(-1==c)return-1;var d=b.substring(this.basePath.length,b.length);return"/"==d[d.length-1]&&"/"!=d?d=d.substring(0,d.length-1):""==d&&(d="/"),-1!=d.lastIndexOf("?")&&(d=d.slice(0,d.lastIndexOf("?"))),d}},{key:"loadState",get:function(){return this[E]},set:function(a){4<a&&10>a?(this._callLoadStateChange(this[E],a),this[E]=a):b.newException({invalidValue:a},"\u0645\u0642\u062F\u0627\u0631 \u0633\u062A \u0634\u062F\u0647 \u0628\u0631\u0627\u06CC \u0648\u0636\u0639\u06CC\u062A \u0644\u0648\u062F\u06CC\u0646\u06AF \u0646\u0645\u06CC\u062A\u0648\u0627\u0646\u062F \u06A9\u0645\u062A\u0631 \u067E\u0646\u062C \u0648 \u0628\u06CC\u0634\u062A\u0631 \u0627\u0632 \u062F\u0647 \u0628\u0627\u0634\u062F \n")}}]),a}();a("default",F)}}});
